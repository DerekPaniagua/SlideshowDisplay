<!DOCTYPE html>
<html>
<head>
    <title>Google Calendar and Slideshow</title>
    <style>
        #calendar {
            height: 50%;
        }

        #slideshow {
            height: 50%;
        }
    </style>
</head>
<body>
    <div id="calendar"></div>
    <div id="slideshow"></div>

    <script src="https://apis.google.com/js/api.js"></script>
    <script src="slideshow.js"></script>
    <script src="calendar.js"></script>
    <script src="common.js"></script>
    <script>
        const config = get_config();

        // Fetch our image list
        retrieve_image_paths(config.images_path)

        // Function to load the Google Calendar API
        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        // Initialize the Google Calendar API client
        function initClient() {
            gapi.client.init({
                apiKey: 'AIzaSyCkBOnbarlPlpQ7Y7hc2F1k0PudV29EOOI',
                discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'],
                clientId: '786992269510-mfvb0fo2u72h60m0psvdg2jlns3pm29e.apps.googleusercontent.com',
                scope: 'https://www.googleapis.com/auth/calendar.readonly'
            }).then(function () {
                loadCalendar();
            }, function (error) {
                console.log('Google Calendar API client initialization error:', error);
            });
        }

        // Load and display the Google Calendar
        function loadCalendar() {
            var calendar = new gapi.client.calendar.CalendarService();
            calendar.calendarList.list().then(function (response) {
                var calendars = response.result.items;
                if (calendars.length > 0) {
                    var primaryCalendar = calendars[0];
                    var calendarId = primaryCalendar.id;
                    var calendarContainer = document.getElementById('calendar');

                    var calendarFrame = document.createElement('iframe');
                    calendarFrame.src = 'https://calendar.google.com/calendar/embed?src=' + calendarId;
                    calendarFrame.width = '100%';
                    calendarFrame.height = '100%';
                    calendarContainer.appendChild(calendarFrame);
                } else {
                    console.log('No available calendars found.');
                }
            }, function (error) {
                console.log('Error loading Google Calendar:', error);
            });
        }

        // Slideshow function to display images
        function startSlideshow() {
            var images = [
                'images/default/skateboard_hd.jpg',
                'images/default/skateboard_santa.jpg',
            ];
            var currentIndex = 0;
            var slideshowContainer = document.getElementById('slideshow');

            function showNextImage() {
                if (currentIndex >= images.length) {
                    currentIndex = 0;
                }

                slideshowContainer.innerHTML = '<img src="' + images[currentIndex] + '" width="100%" height="100%">';
                currentIndex++;

                setTimeout(showNextImage, 3000); // Change image every 3 seconds
            }

            showNextImage();
        }

        // Call the functions to initialize the page
        handleClientLoad();
        startSlideshow();

        function readImageFilesFromPath(filePath, callback) {
            const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif']; // Add more extensions if needed
        
            // Check if FileReader is supported
            if (typeof FileReader !== 'undefined') {
            const inputElement = document.createElement('input');
            inputElement.type = 'file';
            inputElement.multiple = true;
        
            // Event listener for when files are selected
            inputElement.addEventListener('change', function (event) {
                const files = event.target.files;
                const imageFiles = [];
        
                // Iterate over the selected files
                for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
        
                // Check if the file is an image file
                if (imageExtensions.includes(fileExtension)) {
                    imageFiles.push(file);
                }
                }
        
                // Pass the image files to the callback function
                if (typeof callback === 'function') {
                callback(imageFiles);
                }
            });
        
            // Trigger the file input dialog
            inputElement.click();
            } else {
            // FileReader is not supported
            console.error('FileReader is not supported in this browser.');
            }
        }
  
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</body>
</html>
